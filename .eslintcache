[{"/Users/jinmingliu/work/ccc-react-paint/src/index.tsx":"1","/Users/jinmingliu/work/ccc-react-paint/src/CCCPaint.tsx":"2","/Users/jinmingliu/work/ccc-react-paint/src/util/toolType.ts":"3","/Users/jinmingliu/work/ccc-react-paint/src/context/index.ts":"4","/Users/jinmingliu/work/ccc-react-paint/src/util/dispatcher/index.ts":"5","/Users/jinmingliu/work/ccc-react-paint/src/canvas/index.tsx":"6","/Users/jinmingliu/work/ccc-react-paint/src/left-tool/index.tsx":"7","/Users/jinmingliu/work/ccc-react-paint/src/right/index.tsx":"8","/Users/jinmingliu/work/ccc-react-paint/src/edit/index.tsx":"9","/Users/jinmingliu/work/ccc-react-paint/src/util/dispatcher/event.ts":"10","/Users/jinmingliu/work/ccc-react-paint/src/util/tool/shape.ts":"11","/Users/jinmingliu/work/ccc-react-paint/src/util/tool/tool.ts":"12","/Users/jinmingliu/work/ccc-react-paint/src/util/tool/index.ts":"13","/Users/jinmingliu/work/ccc-react-paint/src/util/snapshot/index.ts":"14","/Users/jinmingliu/work/ccc-react-paint/src/right/showShape/index.tsx":"15","/Users/jinmingliu/work/ccc-react-paint/src/right/pen/index.tsx":"16","/Users/jinmingliu/work/ccc-react-paint/src/right/formatColor/index.tsx":"17","/Users/jinmingliu/work/ccc-react-paint/src/right/earser/index.tsx":"18","/Users/jinmingliu/work/ccc-react-paint/src/right/text/index.tsx":"19","/Users/jinmingliu/work/ccc-react-paint/src/util/tool/pen.ts":"20","/Users/jinmingliu/work/ccc-react-paint/src/util/tool/eraser.ts":"21","/Users/jinmingliu/work/ccc-react-paint/src/util/tool/colorFill.ts":"22","/Users/jinmingliu/work/ccc-react-paint/src/util/tool/colorExtract.ts":"23","/Users/jinmingliu/work/ccc-react-paint/src/util/tool/Text.ts":"24","/Users/jinmingliu/work/ccc-react-paint/src/right/components/colorPanel/index.tsx":"25","/Users/jinmingliu/work/ccc-react-paint/src/right/components/shape/index.tsx":"26","/Users/jinmingliu/work/ccc-react-paint/src/right/components/slider/index.tsx":"27","/Users/jinmingliu/work/ccc-react-paint/src/utils.tsx":"28","/Users/jinmingliu/work/ccc-react-paint/src/ToolTypeIcon.tsx":"29","/Users/jinmingliu/work/ccc-react-paint/src/canvas/utils.tsx":"30","/Users/jinmingliu/work/ccc-react-paint/src/util/tool/colorChange.ts":"31"},{"size":161,"mtime":1655091758625,"results":"32","hashOfConfig":"33"},{"size":7125,"mtime":1656138670625,"results":"34","hashOfConfig":"33"},{"size":918,"mtime":1655088099573,"results":"35","hashOfConfig":"33"},{"size":1490,"mtime":1656072920512,"results":"36","hashOfConfig":"33"},{"size":2010,"mtime":1654736372870,"results":"37","hashOfConfig":"33"},{"size":14655,"mtime":1656132185033,"results":"38","hashOfConfig":"33"},{"size":3164,"mtime":1655876054879,"results":"39","hashOfConfig":"33"},{"size":1242,"mtime":1656072676341,"results":"40","hashOfConfig":"33"},{"size":1629,"mtime":1655876132946,"results":"41","hashOfConfig":"33"},{"size":136,"mtime":1655087991761,"results":"42","hashOfConfig":"33"},{"size":8275,"mtime":1656123785651,"results":"43","hashOfConfig":"33"},{"size":3993,"mtime":1656137457049,"results":"44","hashOfConfig":"33"},{"size":247,"mtime":1654748643953,"results":"45","hashOfConfig":"33"},{"size":988,"mtime":1655875211750,"results":"46","hashOfConfig":"33"},{"size":512,"mtime":1655358397568,"results":"47","hashOfConfig":"33"},{"size":874,"mtime":1656064250505,"results":"48","hashOfConfig":"33"},{"size":1078,"mtime":1655885648435,"results":"49","hashOfConfig":"33"},{"size":729,"mtime":1655358536351,"results":"50","hashOfConfig":"33"},{"size":3328,"mtime":1656066188943,"results":"51","hashOfConfig":"33"},{"size":2984,"mtime":1656123785650,"results":"52","hashOfConfig":"33"},{"size":2905,"mtime":1656136297689,"results":"53","hashOfConfig":"33"},{"size":4200,"mtime":1656138657872,"results":"54","hashOfConfig":"33"},{"size":1045,"mtime":1656123785649,"results":"55","hashOfConfig":"33"},{"size":2955,"mtime":1656125628663,"results":"56","hashOfConfig":"33"},{"size":2662,"mtime":1656072920512,"results":"57","hashOfConfig":"33"},{"size":3780,"mtime":1655358336768,"results":"58","hashOfConfig":"33"},{"size":837,"mtime":1655274671520,"results":"59","hashOfConfig":"33"},{"size":1170,"mtime":1656072676349,"results":"60","hashOfConfig":"33"},{"size":13540,"mtime":1655877638790,"results":"61","hashOfConfig":"33"},{"size":367,"mtime":1656067122892,"results":"62","hashOfConfig":"63"},{"size":3823,"mtime":1656135408336,"results":"64","hashOfConfig":"33"},{"filePath":"65","messages":"66","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"67"},"12q7nhl",{"filePath":"68","messages":"69","errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},{"filePath":"70","messages":"71","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"67"},{"filePath":"72","messages":"73","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"67"},{"filePath":"74","messages":"75","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"67"},{"filePath":"76","messages":"77","errorCount":0,"fatalErrorCount":0,"warningCount":17,"fixableErrorCount":0,"fixableWarningCount":0,"source":"78","usedDeprecatedRules":"67"},{"filePath":"79","messages":"80","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"67"},{"filePath":"81","messages":"82","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"67"},{"filePath":"83","messages":"84","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"67"},{"filePath":"85","messages":"86","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"67"},{"filePath":"87","messages":"88","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"67"},{"filePath":"89","messages":"90","errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},{"filePath":"91","messages":"92","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"67"},{"filePath":"93","messages":"94","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"67"},{"filePath":"95","messages":"96","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"67"},{"filePath":"97","messages":"98","errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"99","usedDeprecatedRules":"67"},{"filePath":"100","messages":"101","errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"102","usedDeprecatedRules":"67"},{"filePath":"103","messages":"104","errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"105","usedDeprecatedRules":"67"},{"filePath":"106","messages":"107","errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"108","usedDeprecatedRules":"67"},{"filePath":"109","messages":"110","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"67"},{"filePath":"111","messages":"112","errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},{"filePath":"113","messages":"114","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"115","messages":"116","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"67"},{"filePath":"117","messages":"118","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"67"},{"filePath":"119","messages":"120","errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"121","usedDeprecatedRules":"67"},{"filePath":"122","messages":"123","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"67"},{"filePath":"124","messages":"125","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"67"},{"filePath":"126","messages":"127","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"67"},{"filePath":"128","messages":"129","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"67"},{"filePath":"130","messages":"131","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"132"},"yx3ph1",{"filePath":"133","messages":"134","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},"/Users/jinmingliu/work/ccc-react-paint/src/index.tsx",[],[],"/Users/jinmingliu/work/ccc-react-paint/src/CCCPaint.tsx",["135"],"/Users/jinmingliu/work/ccc-react-paint/src/util/toolType.ts",[],"/Users/jinmingliu/work/ccc-react-paint/src/context/index.ts",[],"/Users/jinmingliu/work/ccc-react-paint/src/util/dispatcher/index.ts",[],"/Users/jinmingliu/work/ccc-react-paint/src/canvas/index.tsx",["136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152"],"import React, { useMemo } from \"react\";\nimport \"./index.less\";\nimport { useEffect } from \"react\";\nimport { useRef } from \"react\";\nimport {\n  LineWidthType,\n  ShapeOutlineType,\n  ShapeToolType,\n  ToolType,\n} from \"../util/toolType\";\nimport { FC } from \"react\";\nimport { useState } from \"react\";\nimport { Pen, Tool, Eraser, ColorFill, Text } from \"../util/tool\";\nimport Shape from \"../util/tool/shape\";\nimport { useContext } from \"react\";\nimport { DispatcherContext } from \"../context\";\nimport { CLEAR_EVENT, REDO_EVENT, UNDO_EVENT } from \"../util/dispatcher/event\";\nimport SnapShot from \"../util/snapshot\";\nimport { Input } from \"antd\";\nimport cursorPen from \"@/assets/icon/cursorPen.jpg\";\nimport cursorErase from \"@/assets/icon/cursorErase.jpg\";\nimport straw from \"@/assets/icon/straw.jpg\";\nimport bucket from \"@/assets/icon/bucket.jpg\";\nimport { getScale } from \"./utils\";\nimport { keys } from \"@material-ui/core/styles/createBreakpoints\";\n\ninterface CanvasProps {\n  toolType: ToolType;\n  shapeType: ShapeToolType;\n  shapeOutlineType: ShapeOutlineType;\n  lineWidthType: LineWidthType;\n  strawType: boolean;\n  mainColor: string;\n  subColor: string;\n  lineSize?: number;\n  fillColor: string;\n  fontStyle: any;\n  imgSrc?: string;\n  CanvasSize?: {\n    width: number;\n    height: number;\n  };\n  id: string;\n  background?: string;\n  onSize?: (value: any) => void;\n  setColor: (value: string) => void;\n}\n\nlet show_scale = 1;\n\nlet translatex = 0;\nlet translatey = 0;\n\nconst maxScale = 6;\nconst minScale = 0.1;\nconst scaleStep = 0.1;\n\nconst Canvas: FC<CanvasProps> = (props) => {\n  const {\n    id,\n    toolType,\n    lineWidthType,\n    mainColor,\n    subColor,\n    setColor,\n    CanvasSize,\n    fillColor,\n    shapeType,\n    shapeOutlineType,\n    fontStyle,\n    imgSrc,\n    background,\n    strawType,\n    lineSize = 1,\n  } = props;\n  const [tool, setTool] = useState<Tool>();\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const allCanvasRef = useRef<HTMLDivElement>(null);\n  const canvasTextRef = useRef<HTMLDivElement>(null);\n  const textBoxRef = useRef<HTMLTextAreaElement>(null);\n  const dispatcherContext = useContext(DispatcherContext);\n  const [snapshot] = useState<SnapShot>(new SnapShot());\n\n  useEffect(() => {\n    showCanvasCursor();\n    switch (toolType) {\n      case ToolType.PEN:\n        setTool(new Pen());\n        break;\n      case ToolType.ERASER:\n        setTool(new Eraser(lineSize));\n        break;\n      // case ToolType.COLOR_EXTRACT:\n      //   setTool(new ColorExtract(setColor));\n      //   break;\n      case ToolType.COLOR_FILL:\n        setTool(new ColorFill());\n        break;\n      case ToolType.TEXT:\n        setTool(new Text(fontStyle));\n        break;\n      case ToolType.SHAPE:\n        setTool(\n          new Shape(shapeType, shapeOutlineType === ShapeOutlineType.DOTTED)\n        );\n        break;\n      default:\n        break;\n    }\n  }, [toolType, shapeType, fontStyle, lineSize]);\n\n  useEffect(() => {\n    if (tool instanceof Shape) {\n      tool.isDashed = shapeOutlineType === ShapeOutlineType.DOTTED;\n    }\n  }, [shapeOutlineType]);\n\n  useEffect(() => {\n    switch (lineWidthType) {\n      case LineWidthType.THIN:\n        Tool.lineWidthFactor = 1;\n        break;\n      case LineWidthType.MIDDLE:\n        Tool.lineWidthFactor = 2;\n        break;\n      case LineWidthType.BOLD:\n        Tool.lineWidthFactor = 3;\n        break;\n      case LineWidthType.MAXBOLD:\n        Tool.lineWidthFactor = 4;\n        break;\n      case LineWidthType.LINESIZE:\n        Tool.lineWidthFactor = lineSize;\n        break;\n      default:\n        break;\n    }\n  }, [lineWidthType, lineSize]);\n\n  useEffect(() => {\n    Tool.mainColor = mainColor;\n  }, [mainColor]);\n\n  useEffect(() => {\n    Tool.fillColor = fillColor;\n  }, [fillColor]);\n\n  useEffect(() => {\n    Tool.subColor = subColor;\n  }, [subColor]);\n\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (canvas) {\n      showCanvasCursor();\n      drawCanvas();\n      Tool.ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\n      // 注册清空画布事件\n      const dispatcher = dispatcherContext.dispatcher;\n      const callback = () => {\n        const ctx = canvas.getContext(\"2d\");\n        if (ctx) {\n          if (imgSrc) {\n            const img = new Image();\n            img.crossOrigin = \"anonymous\";\n            img.src = imgSrc;\n            img.onload = function () {\n              const { width, height } = img;\n              /*1.在canvas 中绘制图像*/\n              ctx.drawImage(img, 0, 0);\n              /*2.从canvas 中获取图像的ImageData*/\n              const imgData = ctx.getImageData(0, 0, width, height);\n              /*3.在canvas 中显示ImageData*/\n              ctx.putImageData(\n                imgData,\n                //位置\n                0,\n                height\n              );\n              snapshot.add(imgData);\n            };\n          } else {\n            ctx.fillStyle = \"#2d2d2d\";\n            ctx.fillRect(0, 0, canvas.width, canvas.height);\n          }\n        }\n      };\n      dispatcher.on(CLEAR_EVENT, callback);\n\n      // 注册画布前进事件\n      const forward = () => {\n        const ctx = canvas.getContext(\"2d\");\n        if (ctx) {\n          const imageData = snapshot.forward();\n          if (imageData) {\n            ctx.clearRect(0, 0, canvas.width, canvas.height);\n            ctx.putImageData(imageData, 0, 0);\n          }\n        }\n      };\n      dispatcher.on(REDO_EVENT, forward);\n\n      // 注册画布后退事件\n      const back = () => {\n        const ctx = canvas.getContext(\"2d\");\n        if (ctx) {\n          const imageData = snapshot.back();\n          if (imageData) {\n            ctx.clearRect(0, 0, canvas.width, canvas.height);\n            ctx.putImageData(imageData, 0, 0);\n          }\n        }\n      };\n      dispatcher.on(UNDO_EVENT, back);\n\n      return () => {\n        dispatcher.off(CLEAR_EVENT, callback);\n      };\n    }\n  }, [canvasRef]);\n\n  useEffect(() => {\n    showCanvasCursor();\n  }, [strawType]);\n\n  //鼠标icon\n  const showCanvasCursor = () => {\n    const canvas = canvasRef.current;\n    const textBox = textBoxRef.current;\n    if (canvas) {\n      if (strawType) {\n        //吸色\n        return (canvas.style.cursor = `url(${straw}),auto`);\n      }\n      if (toolType === 0) {\n        canvas.style.cursor = `url(${cursorPen}) 12 16,auto`;\n      } else if (toolType === 4) {\n        canvas.style.cursor = `url(${cursorErase}),auto`;\n      } else if (toolType === 1) {\n        canvas.style.cursor = `url(${bucket}),auto`;\n      } else {\n        canvas.style.cursor = `auto`;\n      }\n      if (toolType !== 2) {\n        textBox!.setAttribute(\"style\", `z-index:-1;display:none`);\n      }\n    }\n  };\n\n  const drawCanvas = () => {\n    const canvas = canvasRef.current;\n    const container = allCanvasRef!.current;\n    const textRef = canvasTextRef.current;\n    if (canvas && container && textRef) {\n      const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\n      if (imgSrc) {\n        const img = new Image();\n        img.crossOrigin = \"anonymous\";\n        img.src = imgSrc;\n        img.onload = function () {\n          canvas.height = img.height;\n          canvas.width = img.width;\n          /*1.在canvas 中绘制图像*/\n          // ctx.scale(showScale, showScale);\n          textRef.setAttribute(\n            \"style\",\n            `width:${canvas.width};height:${canvas.height}`\n          );\n          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n          snapshot.add(ctx.getImageData(0, 0, canvas.width, canvas.height));\n        };\n      } else if (CanvasSize) {\n        canvas.height = CanvasSize.height;\n        canvas.width = CanvasSize.width;\n        ctx.fillStyle = background || \"#2d2d2d\";\n        ctx.fillRect(0, 0, canvas.width, canvas.height);\n        snapshot.add(ctx.getImageData(0, 0, canvas.width, canvas.height));\n      }\n    }\n  };\n\n  useEffect(() => {\n    const container = allCanvasRef!.current;\n    const canvas = canvasRef.current;\n\n    if (CanvasSize && container && canvas) {\n      if (Tool.ctx) {\n        Tool.ctx.clearRect(0, 0, canvas.width, canvas?.height);\n      }\n      drawCanvas();\n      const height = container!.clientHeight;\n      const width = container!.clientWidth;\n      const showScale =\n        Math.min(width, height) /\n          Math.max(CanvasSize.height, CanvasSize.width) || 1;\n      show_scale = showScale; //getScale({ width, height }, CanvasSize);\n      Tool.currentScale = show_scale;\n      translatex = (width - CanvasSize.width * show_scale) / 2;\n      translatey = (height - CanvasSize.height * show_scale) / 2;\n      canvas.style.transform = `scale(${show_scale}) translate(${translatex}px,${translatey}px)`;\n    }\n  }, [CanvasSize]);\n\n  const onMouseDown = (event: MouseEvent) => {\n    if (tool) {\n      tool.onMouseDown(event);\n    }\n  };\n\n  const onMouseMove = (event: MouseEvent) => {\n    if (tool) {\n      tool.onMouseMove(event);\n    }\n  };\n\n  const onMouseUp = (event: MouseEvent) => {\n    if (tool) {\n      tool.onMouseUp(event);\n      // 存储canvas剪影\n      snapshot.add(\n        Tool.ctx.getImageData(\n          0,\n          0,\n          Tool.ctx.canvas.width,\n          Tool.ctx.canvas.height\n        )\n      );\n    }\n  };\n\n  const onTouchStart = (event: TouchEvent) => {\n    if (tool) {\n      tool.onTouchStart(event);\n    }\n  };\n\n  const onTouchMove = (event: TouchEvent) => {\n    if (tool) {\n      tool.onTouchMove(event);\n    }\n  };\n\n  const onTouchEnd = (event: TouchEvent) => {\n    if (tool) {\n      tool.onTouchEnd(event);\n    }\n    // 存储canvas剪影\n    snapshot.add(\n      Tool.ctx.getImageData(0, 0, Tool.ctx.canvas.width, Tool.ctx.canvas.height)\n    );\n  };\n\n  const getTrans = (\n    client: number,\n    newScale: number,\n    direction: string,\n    img: any,\n    boxdom: any,\n    scale: number\n  ) => {\n    const lastTrans = direction === \"width\" ? translatex : translatey;\n    // console.log(\"已经偏移的距离:\", lastTrans);\n\n    const sizeChanage = img[direction] * newScale - img[direction] * scale;\n    // console.log(`img ${direction}放大了:`, sizeChanage);\n\n    // 整体已经移动过了，需要弥补回来\n    const pre = client - lastTrans - boxdom[direction === \"width\" ? \"x\" : \"y\"];\n\n    //console.log(\"缩放中心到边界的距离\", pre);\n\n    const percent = pre / (img[direction] * scale);\n\n    //  console.log(\"当前缩放尺度下，缩放中心到边界比例\", percent);\n\n    const trans = percent * sizeChanage;\n    // console.log(\"缩放中心移动的距离:\", trans);\n    return trans;\n  };\n\n  const onMousewheel = (event: any) => {\n    event.preventDefault();\n    const canvas = canvasRef.current;\n    const container = allCanvasRef!.current;\n    const { clientX, clientY, deltaX, deltaY, ctrlKey } = event;\n    const { width, height, x, y } = container!.getBoundingClientRect();\n    const { width: canvasWidth, height: canvasHeight } =\n      container!.getBoundingClientRect();\n    let newScale;\n    if (ctrlKey) {\n      //双指放大缩小\n      if (deltaY < 0) {\n        newScale = show_scale + scaleStep;\n        newScale = Math.min(newScale, maxScale);\n      } else {\n        newScale = show_scale - scaleStep;\n        newScale = Math.max(newScale, minScale);\n      }\n      const transX = getTrans(\n        clientX,\n        newScale,\n        \"width\",\n        CanvasSize,\n        {\n          width,\n          height,\n          x,\n          y,\n        },\n        show_scale\n      );\n      const transY = getTrans(\n        clientY,\n        newScale,\n        \"height\",\n        CanvasSize,\n        {\n          width,\n          height,\n          x,\n          y,\n        },\n        show_scale\n      );\n      translatex = translatex - transX;\n      translatey = translatey - transY;\n      show_scale = newScale;\n      Tool.currentScale = newScale;\n      canvas!.style.transform = `translate3d(${translatex}px, ${translatey}px, 0px) scale(${show_scale})`;\n    } else {\n      if (!!deltaX && !deltaY) {\n        // if (translatex > 0 && translatex < width) {\n        // 左右移动 向右 -deltaX < 0  向左   >0\n        translatex = Number((translatex - deltaX).toFixed(3));\n        // }\n      } else if (!!deltaY && !deltaX) {\n        // if (translatey > 0 && translatex < height) {\n        // 左右移动 向右 -deltaX < 0  向左   >0\n        translatey = Number((translatey - deltaY).toFixed(3));\n        // }\n      }\n\n      canvas!.style.transform = `translate(${translatex}px, ${translatey}px) scale(${show_scale})`;\n    }\n  };\n\n  const onKeyDown = (e: KeyboardEvent) => {\n    if (tool) {\n      tool.onKeyDown(e);\n    }\n  };\n\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    const textBox = textBoxRef.current;\n    if (canvas && textBox) {\n      canvas.addEventListener(\"mousedown\", onMouseDown);\n      canvas.addEventListener(\"mousemove\", onMouseMove);\n      canvas.addEventListener(\"mouseup\", onMouseUp);\n      canvas.addEventListener(\"wheel\", onMousewheel, { passive: false });\n      canvas.addEventListener(\"touchstart\", onTouchStart);\n      canvas.addEventListener(\"touchmove\", onTouchMove);\n      canvas.addEventListener(\"touchend\", onTouchEnd);\n      textBox.addEventListener(\"keydown\", onKeyDown);\n\n      return () => {\n        canvas.removeEventListener(\"mousedown\", onMouseDown);\n        canvas.removeEventListener(\"mousemove\", onMouseMove);\n        canvas.removeEventListener(\"mouseup\", onMouseUp);\n        canvas.removeEventListener(\"wheel\", onMousewheel);\n\n        canvas.removeEventListener(\"touchstart\", onTouchStart);\n        canvas.removeEventListener(\"touchmove\", onTouchMove);\n        canvas.removeEventListener(\"touchend\", onTouchEnd);\n      };\n    }\n  }, [canvasRef, onMouseDown, onMouseMove, onMouseUp]);\n\n  const style = {\n    margin: \"auto\",\n  };\n  if (allCanvasRef && CanvasSize) {\n    const allCanvas = allCanvasRef.current;\n    if (allCanvas) {\n      style.margin =\n        allCanvas.offsetWidth < (CanvasSize?.width || 0) ? \"unset\" : \"auto\";\n    }\n  }\n  return (\n    <div className=\"all-canvas\" ref={allCanvasRef}>\n      <canvas\n        id={`ccc-paint-canvas ${id}`}\n        className=\"ccc-paint-canvas\"\n        ref={canvasRef}\n        style={{\n          background: background || \"#fff\",\n          ...style,\n        }}\n      ></canvas>\n      <div className=\"canvas-text\" id=\"text-container\" ref={canvasTextRef}>\n        <textarea\n          ref={textBoxRef}\n          id=\"textBox\"\n          name=\"story\"\n          autoFocus={true}\n          //autocomplete={fales}\n          //bordered={true}\n          // autoSize={{ minRows: 2, maxRows: 2 }}\n          className={`text-box`}\n          // rows={1}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default Canvas;\n","/Users/jinmingliu/work/ccc-react-paint/src/left-tool/index.tsx",[],"/Users/jinmingliu/work/ccc-react-paint/src/right/index.tsx",[],"/Users/jinmingliu/work/ccc-react-paint/src/edit/index.tsx",[],"/Users/jinmingliu/work/ccc-react-paint/src/util/dispatcher/event.ts",[],"/Users/jinmingliu/work/ccc-react-paint/src/util/tool/shape.ts",[],"/Users/jinmingliu/work/ccc-react-paint/src/util/tool/tool.ts",["153"],"/Users/jinmingliu/work/ccc-react-paint/src/util/tool/index.ts",[],"/Users/jinmingliu/work/ccc-react-paint/src/util/snapshot/index.ts",[],"/Users/jinmingliu/work/ccc-react-paint/src/right/showShape/index.tsx",[],"/Users/jinmingliu/work/ccc-react-paint/src/right/pen/index.tsx",["154","155"],"import React, { FC } from \"react\";\nimport { useContext } from \"react\";\nimport { LineWidthContext } from \"@/context\";\nimport IntegerStep from \"../components/slider\";\nimport ColorPanel from \"../components/colorPanel\";\nimport \"./index.less\";\nimport { Tool } from \"../../util/tool\";\n\ninterface PenType {\n  lineSize: number;\n}\n\nconst ShowPen = (props: PenType) => {\n  const lineWidthContext = useContext(LineWidthContext);\n\n  const { lineSize } = props;\n\n  return (\n    <div className=\"ccc-pen\">\n      <div className=\"ccc-slider-item\">\n        <h3>Brush Thickness</h3>\n        <IntegerStep\n          min={1}\n          max={20}\n          value={lineSize}\n          onPropsChange={(value) => {\n            lineWidthContext.setLineSize(value);\n          }}\n        />\n      </div>\n      <ColorPanel type=\"pen\" className=\"toolbar-item\" />\n    </div>\n  );\n};\n\nexport default ShowPen;\n","/Users/jinmingliu/work/ccc-react-paint/src/right/formatColor/index.tsx",["156","157"],"import React from \"react\";\nimport { useContext } from \"react\";\nimport { FillContext } from \"@/context\";\nimport { ColorBox, createColor } from \"material-ui-color\";\nimport \"./index.less\";\nimport { useState } from \"react\";\nimport { useEffect } from \"react\";\nimport ColorPanel from \"../components/colorPanel\";\ninterface FormatColor {\n  className?: string;\n}\n\nconst FormatColor: React.FC<FormatColor> = (props) => {\n  const { className } = props;\n  const [pickerColor, setPickerColor] = useState(createColor(\"#000000FF\"));\n  const FillColorContext = useContext(FillContext);\n  //   const activeColorType = colorContext.activeColor;\n\n  useEffect(() => {\n    FillColorContext.setFillColor(`#${pickerColor.hex}`);\n  }, [pickerColor]);\n\n  return (\n    <div className={className ? `formatColor ${className}` : \"colorpanel\"}>\n      <div className=\"content\">\n        <ColorPanel\n          className=\"toolbar-item\"\n          onChange={(color: string) => {\n            FillColorContext.setFillColor(color);\n          }}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default FormatColor;\n","/Users/jinmingliu/work/ccc-react-paint/src/right/earser/index.tsx",["158"],"import React, { FC } from \"react\";\nimport { useContext } from \"react\";\nimport { LineWidthContext } from \"@/context\";\nimport IntegerStep from \"../components/slider\";\nimport \"./index.less\";\n\ninterface earserType {\n  lineSize: number;\n}\n\nconst Eraser = (props: earserType) => {\n  const { lineSize } = props;\n  const lineWidthContext = useContext(LineWidthContext);\n  return (\n    <div className=\"ccc-pen\">\n      <div className=\"ccc-slider-item\">\n        <h3>Eraser Thickness</h3>\n        <IntegerStep\n          min={1}\n          max={20}\n          value={lineSize}\n          onPropsChange={(value) => {\n            lineWidthContext.setLineSize(value);\n          }}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default Eraser;\n","/Users/jinmingliu/work/ccc-react-paint/src/right/text/index.tsx",["159","160","161"],"import React from \"react\";\nimport { useContext } from \"react\";\nimport { TextContext, ColorContext } from \"@/context\";\nimport { ColorBox, createColor } from \"material-ui-color\";\nimport \"./index.less\";\nimport { useState } from \"react\";\nimport { useEffect } from \"react\";\nimport { Select } from \"antd\";\nimport IntegerStep from \"../components/slider\";\nimport ColorPanel from \"../components/colorPanel\";\nimport { useMemo } from \"react\";\n\nconst { Option } = Select;\n\ninterface FormatColor {\n  className?: string;\n}\n\nconst textFamily = [\n  \"Barlow-ExtraBold\",\n  \"DIN-AlternateBold\",\n  \"Trebuchet-MSBold\",\n  \"Trebuchet-MS\",\n  \"Poppins-Bold\",\n  \"Poppins-Light\",\n  \"Poppins-Medium\",\n  \"Poppins-Regular\",\n  \"Poppins-SemiBold\",\n];\n\nconst FormatColor: React.FC<FormatColor> = (props) => {\n  const { className } = props;\n  const [pickerColor, setPickerColor] = useState(createColor(\"#000000FF\"));\n  const TextToolContext = useContext(TextContext);\n  const colorContext = useContext(ColorContext);\n\n  const fontStyle = useMemo(() => {\n    return TextToolContext.fontStyle;\n  }, [TextToolContext.fontStyle]);\n\n  const activeColorType = colorContext.activeColor;\n\n  useEffect(() => {\n    colorContext.setColor(`#${pickerColor.hex}`);\n  }, [pickerColor]);\n\n  return (\n    <div\n      className={\n        className ? `ccc-text formatColor ${className}` : \"ccc-text colorpanel\"\n      }\n    >\n      <div className=\"content\">\n        <div>\n          <h3>Font</h3>\n          <Select\n            className=\"ccc-text-family\"\n            onChange={(value: string) => {\n              TextToolContext.setFont({\n                ...fontStyle,\n                fontFamily: value,\n              });\n            }}\n          >\n            {textFamily.map((va) => {\n              return (\n                <Option key={va} value={va}>\n                  {va}\n                </Option>\n              );\n            })}\n          </Select>\n        </div>\n        <div className=\"font\">\n          <h3>Letter Spacing</h3>\n          <IntegerStep\n            min={1}\n            max={8}\n            onPropsChange={(value) => {\n              TextToolContext.setFont({\n                ...fontStyle,\n                letterSpacing: value + \"px\",\n              });\n            }}\n          />\n        </div>\n        <div className=\"font\">\n          <h3>Font Size</h3>\n          <IntegerStep\n            min={12}\n            max={72}\n            onPropsChange={(value) => {\n              TextToolContext.setFont({\n                ...fontStyle,\n                fontSize: value + \"px\",\n              });\n            }}\n          />\n        </div>\n        <div className=\"font\">\n          <h3>Line Height</h3>\n          <IntegerStep\n            min={24}\n            max={56}\n            onPropsChange={(value) => {\n              TextToolContext.setFont({\n                ...fontStyle,\n                lineHeight: value + \"px\",\n              });\n            }}\n          />\n        </div>\n        <div className=\"material-color-box\">\n          <ColorPanel\n            type=\"text\"\n            className=\"toolbar-item\"\n            onChange={(color: string) => {\n              TextToolContext.setFont({\n                ...fontStyle,\n                color: color,\n              });\n            }}\n          />\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default FormatColor;\n","/Users/jinmingliu/work/ccc-react-paint/src/util/tool/pen.ts",[],"/Users/jinmingliu/work/ccc-react-paint/src/util/tool/eraser.ts",["162"],"/Users/jinmingliu/work/ccc-react-paint/src/util/tool/colorFill.ts",[],"/Users/jinmingliu/work/ccc-react-paint/src/util/tool/colorExtract.ts",[],"/Users/jinmingliu/work/ccc-react-paint/src/util/tool/Text.ts",[],"/Users/jinmingliu/work/ccc-react-paint/src/right/components/colorPanel/index.tsx",["163","164","165","166","167","168"],"import React from \"react\";\nimport { useContext } from \"react\";\nimport { ColorContext, ToolTypeContext } from \"@/context\";\nimport { ColorBox, createColor } from \"material-ui-color\";\nimport {\n  Pen,\n  Tool,\n  Eraser,\n  ColorExtract,\n  ColorFill,\n  Text,\n} from \"../../../util/tool\";\nimport \"./index.less\";\nimport { useState } from \"react\";\nimport { useEffect } from \"react\";\nimport { getRandomColor } from \"../../../utils\";\nimport { strawIcon } from \"../../../ToolTypeIcon\";\n\ninterface ColorPanelProps {\n  className?: string;\n  testTool?: Tool;\n  type?: string;\n  onChange?: (color: string) => void;\n}\n\nconst activeColorTypeCls = \"active-color-type\";\n\nconst ColorPanel: React.FC<ColorPanelProps> = (props) => {\n  const { className, type, onChange, testTool } = props;\n  const [pickerColor, setPickerColor] = useState(\n    createColor(type && type === \"pen\" ? getRandomColor() : \"#000000FF\")\n  );\n  const colorContext = useContext(ColorContext);\n  const ToolContext = useContext(ToolTypeContext);\n\n  useEffect(() => {\n    colorContext.setColor(`#${pickerColor.hex}`);\n  }, [pickerColor, testTool]);\n\n  const getStrawColor = () => {\n    const startTime = new Date().getTime();\n    const intervalId = setInterval(function () {\n      const endTime = new Date().getTime();\n      if (Math.abs(endTime - startTime) >= 10 * 60 * 1000) {\n        clearInterval(intervalId); //清除定时器 ,超过10分钟没有吸色功能 清楚定时器\n        ToolContext.setStrawType(false);\n      }\n      if (Tool.strawColor) {\n        setPickerColor(createColor(Tool.strawColor));\n        ToolContext.setStrawType(false);\n        clearInterval(intervalId); //清除定时器\n      }\n    }, 200);\n  };\n\n  return (\n    <div className={className ? `colorpanel ${className}` : \"colorpanel\"}>\n      <div className=\"content\">\n        <h3>Color</h3>\n        <div className=\"material-color-box\">\n          <ColorBox\n            value={pickerColor}\n            disableAlpha={false}\n            onChange={(color) => {\n              setPickerColor(color);\n              Tool.strawColor = \"\";\n              if (onChange) {\n                onChange(`#${color.hex}`);\n              }\n            }}\n          />\n          {type !== \"text\" && (\n            <span\n              className={`straw-color ${Tool.strawFlag ? \"select-item\" : \"\"}`}\n              onClick={() => {\n                Tool.strawFlag = true;\n                Tool.strawColor = \"\";\n                ToolContext.setStrawType(true);\n                getStrawColor();\n              }}\n            >\n              {strawIcon}\n            </span>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ColorPanel;\n","/Users/jinmingliu/work/ccc-react-paint/src/right/components/shape/index.tsx",[],"/Users/jinmingliu/work/ccc-react-paint/src/right/components/slider/index.tsx",[],"/Users/jinmingliu/work/ccc-react-paint/src/utils.tsx",[],"/Users/jinmingliu/work/ccc-react-paint/src/ToolTypeIcon.tsx",[],"/Users/jinmingliu/work/ccc-react-paint/src/canvas/utils.tsx",[],[],"/Users/jinmingliu/work/ccc-react-paint/src/util/tool/colorChange.ts",[],{"ruleId":"169","severity":1,"message":"170","line":1,"column":17,"nodeType":"171","messageId":"172","endLine":1,"endColumn":20},{"ruleId":"169","severity":1,"message":"173","line":1,"column":17,"nodeType":"171","messageId":"172","endLine":1,"endColumn":24},{"ruleId":"169","severity":1,"message":"174","line":19,"column":10,"nodeType":"171","messageId":"172","endLine":19,"endColumn":15},{"ruleId":"169","severity":1,"message":"175","line":24,"column":10,"nodeType":"171","messageId":"172","endLine":24,"endColumn":18},{"ruleId":"169","severity":1,"message":"176","line":25,"column":10,"nodeType":"171","messageId":"172","endLine":25,"endColumn":14},{"ruleId":"169","severity":1,"message":"177","line":65,"column":5,"nodeType":"171","messageId":"172","endLine":65,"endColumn":13},{"ruleId":"178","severity":1,"message":"179","line":245,"column":9,"nodeType":"180","messageId":"181","endLine":245,"endColumn":17,"suggestions":"182"},{"ruleId":"178","severity":1,"message":"179","line":252,"column":23,"nodeType":"180","messageId":"181","endLine":252,"endColumn":36,"suggestions":"183"},{"ruleId":"178","severity":1,"message":"179","line":283,"column":23,"nodeType":"180","messageId":"181","endLine":283,"endColumn":36,"suggestions":"184"},{"ruleId":"178","severity":1,"message":"179","line":291,"column":22,"nodeType":"180","messageId":"181","endLine":291,"endColumn":32,"suggestions":"185"},{"ruleId":"178","severity":1,"message":"179","line":292,"column":21,"nodeType":"180","messageId":"181","endLine":292,"endColumn":31,"suggestions":"186"},{"ruleId":"178","severity":1,"message":"179","line":384,"column":23,"nodeType":"180","messageId":"181","endLine":384,"endColumn":36,"suggestions":"187"},{"ruleId":"178","severity":1,"message":"179","line":386,"column":37,"nodeType":"180","messageId":"181","endLine":386,"endColumn":47,"suggestions":"188"},{"ruleId":"169","severity":1,"message":"189","line":387,"column":20,"nodeType":"171","messageId":"172","endLine":387,"endColumn":31},{"ruleId":"169","severity":1,"message":"190","line":387,"column":41,"nodeType":"171","messageId":"172","endLine":387,"endColumn":53},{"ruleId":"178","severity":1,"message":"179","line":388,"column":7,"nodeType":"180","messageId":"181","endLine":388,"endColumn":17,"suggestions":"191"},{"ruleId":"178","severity":1,"message":"179","line":429,"column":7,"nodeType":"180","messageId":"181","endLine":429,"endColumn":14,"suggestions":"192"},{"ruleId":"178","severity":1,"message":"179","line":443,"column":7,"nodeType":"180","messageId":"181","endLine":443,"endColumn":14,"suggestions":"193"},{"ruleId":"178","severity":1,"message":"179","line":12,"column":58,"nodeType":"180","messageId":"181","endLine":12,"endColumn":62,"suggestions":"194"},{"ruleId":"169","severity":1,"message":"195","line":1,"column":17,"nodeType":"171","messageId":"172","endLine":1,"endColumn":19},{"ruleId":"169","severity":1,"message":"196","line":7,"column":10,"nodeType":"171","messageId":"172","endLine":7,"endColumn":14},{"ruleId":"169","severity":1,"message":"197","line":4,"column":10,"nodeType":"171","messageId":"172","endLine":4,"endColumn":18},{"ruleId":"169","severity":1,"message":"198","line":15,"column":23,"nodeType":"171","messageId":"172","endLine":15,"endColumn":37},{"ruleId":"169","severity":1,"message":"195","line":1,"column":17,"nodeType":"171","messageId":"172","endLine":1,"endColumn":19},{"ruleId":"169","severity":1,"message":"197","line":4,"column":10,"nodeType":"171","messageId":"172","endLine":4,"endColumn":18},{"ruleId":"169","severity":1,"message":"198","line":33,"column":23,"nodeType":"171","messageId":"172","endLine":33,"endColumn":37},{"ruleId":"169","severity":1,"message":"199","line":41,"column":9,"nodeType":"171","messageId":"172","endLine":41,"endColumn":24},{"ruleId":"169","severity":1,"message":"200","line":1,"column":10,"nodeType":"171","messageId":"172","endLine":1,"endColumn":19},{"ruleId":"169","severity":1,"message":"201","line":6,"column":3,"nodeType":"171","messageId":"172","endLine":6,"endColumn":6},{"ruleId":"169","severity":1,"message":"202","line":8,"column":3,"nodeType":"171","messageId":"172","endLine":8,"endColumn":9},{"ruleId":"169","severity":1,"message":"203","line":9,"column":3,"nodeType":"171","messageId":"172","endLine":9,"endColumn":15},{"ruleId":"169","severity":1,"message":"204","line":10,"column":3,"nodeType":"171","messageId":"172","endLine":10,"endColumn":12},{"ruleId":"169","severity":1,"message":"205","line":11,"column":3,"nodeType":"171","messageId":"172","endLine":11,"endColumn":7},{"ruleId":"169","severity":1,"message":"206","line":26,"column":7,"nodeType":"171","messageId":"172","endLine":26,"endColumn":25},"@typescript-eslint/no-unused-vars","'Ref' is defined but never used.","Identifier","unusedVar","'useMemo' is defined but never used.","'Input' is defined but never used.","'getScale' is defined but never used.","'keys' is defined but never used.","'setColor' is assigned a value but never used.","@typescript-eslint/no-non-null-assertion","Forbidden non-null assertion.","TSNonNullExpression","noNonNull",["207"],["208"],["209"],["210"],["211"],["212"],["213"],"'canvasWidth' is assigned a value but never used.","'canvasHeight' is assigned a value but never used.",["214"],["215"],["216"],["217"],"'FC' is defined but never used.","'Tool' is defined but never used.","'ColorBox' is defined but never used.","'setPickerColor' is assigned a value but never used.","'activeColorType' is assigned a value but never used.","'ColorType' is defined but never used.","'Pen' is defined but never used.","'Eraser' is defined but never used.","'ColorExtract' is defined but never used.","'ColorFill' is defined but never used.","'Text' is defined but never used.","'activeColorTypeCls' is assigned a value but never used.",{"messageId":"218","fix":"219","desc":"220"},{"messageId":"218","fix":"221","desc":"220"},{"messageId":"218","fix":"222","desc":"220"},{"messageId":"218","fix":"223","desc":"220"},{"messageId":"218","fix":"224","desc":"220"},{"messageId":"218","fix":"225","desc":"220"},{"messageId":"218","fix":"226","desc":"220"},{"messageId":"218","fix":"227","desc":"220"},{"messageId":"218","fix":"228","desc":"220"},{"messageId":"218","fix":"229","desc":"220"},{"messageId":"218","fix":"230","desc":"220"},"suggestOptionalChain",{"range":"231","text":"232"},"Consider using the optional chain operator `?.` instead. This operator includes runtime checks, so it is safer than the compile-only non-null assertion operator.",{"range":"233","text":"232"},{"range":"234","text":"232"},{"range":"235","text":"232"},{"range":"236","text":"232"},{"range":"237","text":"232"},{"range":"238","text":"232"},{"range":"239","text":"232"},{"range":"240","text":"232"},{"range":"241","text":"232"},{"range":"242","text":"232"},[6528,6529],"?",[6701,6702],[7820,7821],[8059,8060],[8104,8105],[10431,10432],[10552,10553],[10651,10652],[11545,11546],[12090,12091],[262,263]]